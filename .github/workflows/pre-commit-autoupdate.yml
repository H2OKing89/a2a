name: Pre-commit Autoupdate

on:
  schedule:
    # Run weekly on Sundays at midnight UTC
  - cron: 0 0 * * 0
  workflow_dispatch:

permissions:
  contents: write
  pull-requests: write

jobs:
  autoupdate:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4

    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.12'

    - name: Install pre-commit
      run: pip install pre-commit

    - name: Run pre-commit autoupdate
      run: pre-commit autoupdate

    - name: Check for changes
      id: check
      run: |
        if git diff --quiet .pre-commit-config.yaml; then
          echo "changed=false" >> $GITHUB_OUTPUT
        else
          echo "changed=true" >> $GITHUB_OUTPUT
        fi

    - name: Create Pull Request
      if: steps.check.outputs.changed == 'true'
      uses: peter-evans/create-pull-request@v6
      with:
        commit-message: 'chore: update pre-commit hooks'
        title: 'chore: update pre-commit hooks'
        body: |
          This PR updates pre-commit hooks to their latest versions.

          Auto-generated by pre-commit autoupdate workflow.
        branch: chore/pre-commit-autoupdate
        delete-branch: true
